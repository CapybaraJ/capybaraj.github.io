<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>智能合约漏洞介绍2 | CapybaraJ</title><meta name="author" content="CapybaraJ"><meta name="copyright" content="CapybaraJ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这篇讲述DASP TOP 10后面4-6类：未严格判断不安全函数调用返回值、拒绝服务、伪随机性"><meta property="og:type" content="article"><meta property="og:title" content="智能合约漏洞介绍2"><meta property="og:url" content="https://fatheadrat.tk/posts/a92d10ea/index.html"><meta property="og:site_name" content="CapybaraJ"><meta property="og:description" content="这篇讲述DASP TOP 10后面4-6类：未严格判断不安全函数调用返回值、拒绝服务、伪随机性"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2024/05/18/VPBtei4gC5Mlf8Z.png"><meta property="article:published_time" content="2020-04-03T08:43:33.000Z"><meta property="article:modified_time" content="2024-05-18T12:58:23.497Z"><meta property="article:author" content="CapybaraJ"><meta property="article:tag" content="SmartContract"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2024/05/18/VPBtei4gC5Mlf8Z.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://fatheadrat.tk/posts/a92d10ea/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"CKT5R5Q1NC","apiKey":"8ccc173c8e04c7a01ba35c5ffd24d779","indexName":"capy_blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":666,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: CapybaraJ","link":"链接: ","source":"来源: CapybaraJ","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"智能合约漏洞介绍2",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-05-18 20:58:23"}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://s2.loli.net/2024/05/18/VPBtei4gC5Mlf8Z.png)"><nav id="nav"><span id="blog-info"><a href="/" title="CapybaraJ"><span class="site-name">CapybaraJ</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">智能合约漏洞介绍2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-04-03T08:43:33.000Z" title="发表于 2020-04-03 16:43:33">2020-04-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-18T12:58:23.497Z" title="更新于 2024-05-18 20:58:23">2024-05-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/BlockChain/">BlockChain</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="智能合约漏洞介绍2"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>这篇讲述DASP TOP 10后面4-6类：未严格判断不安全函数调用返回值、拒绝服务、伪随机性</p><span id="more"></span><p><a href="https://www.dasp.co/" rel="external nofollow noreferrer">DASP Top 10</a>，有个博主把这10类漏洞都大概描述了一下，写得真的是非常好，</p><p>repo大法！<a href="http://rickgray.me/2018/05/17/ethereum-smart-contracts-vulnerabilites-review/" rel="external nofollow noreferrer">以太坊智能合约安全入门了解一下（上）</a> <a href="https://rickgray.me/2018/05/26/ethereum-smart-contracts-vulnerabilities-review-part2/" rel="external nofollow noreferrer">以太坊智能合约安全入门了解一下（下）</a></p><p>但是这篇文章还是偏向于代码向和实际用例，看心情翻牌讲</p><ol><li>Reentrancy - 重入</li><li>Access Control - 访问控制</li><li>Arithmetic Issues - 算术问题（整数溢出）</li><li><strong>Unchecked Return Values For Low Level Calls - 未严格判断不安全函数调用返回值</strong></li><li><strong>Denial of Service - 拒绝服务</strong></li><li><strong>Bad Randomness - 伪随机性</strong></li><li>Front Running - 提前交易</li><li>Time manipulation - 时间操纵</li><li>Short Address Attack - 短地址攻击</li><li>Unknown Unknowns - 其他未知</li></ol><h2 id="未严格判断不安全函数调用返回值">未严格判断不安全函数调用返回值</h2><p>这个还是很好理解的，感觉没啥特别好说的，后续在对Mythril的功能测评的时候，会提到这个漏洞的！不过现在如果你去用remix啊这类编译器，还是会提示你这个问题的，所以目前来说，它对以太坊的影响应该会慢慢消失，除非你，从不看warnings…</p><h3 id="基本原理">基本原理</h3><p>引用DASP TOP 10的说法：</p><blockquote><p>One of the deeper features of Solidity are the low level functions <code>call()</code>, <code>callcode()</code>, <code>delegatecall()</code> and <code>send()</code>. Their behavior in accounting for errors is quite different from other Solidity functions, as they will not propagate (or bubble up) and will not lead to a total reversion of the current execution. Instead, they will return a boolean value set to <code>false</code>, and the code will continue to run. This can surprise developers and, if the return value of such low-level calls are not checked, can lead to fail-opens and other unwanted outcomes. Remember, <strong>send can fail!</strong></p><p>低级别的功能<code>call()</code>，<code>callcode()</code>，<code>delegatecall()</code>和<code>send()</code>，它们解决错误的行为与其他Solidity函数完全不同，因为它们不会传播（或冒泡），也不会导致当前执行的全部还原。相反，它们将返回设置为的布尔值<code>false</code>，并且代码将继续运行。这可能会使开发人员感到吃惊，并且，如果不检查此类低级调用的返回值，可能会导致失败打开和其他不良后果。记住，<strong>发送可能失败！</strong></p></blockquote><h3 id="实际例子">实际例子</h3><ul><li><a href="https://www.kingoftheether.com/postmortem.html" rel="external nofollow noreferrer">King of the Ether</a><br>(<a href="https://github.com/kieranelby/KingOfTheEtherThrone/blob/v0.4.0/contracts/KingOfTheEtherThrone.sol" rel="external nofollow noreferrer">https://github.com/kieranelby/KingOfTheEtherThrone/blob/v0.4.0/contracts/KingOfTheEtherThrone.sol</a>)</li><li><a href="https://aakilfernandes.github.io/blockhashes-are-only-good-for-256-blocks" rel="external nofollow noreferrer">Etherpot</a></li></ul><p>不详细说了</p><h2 id="拒绝服务">拒绝服务</h2><h3 id="基本原理-2">基本原理</h3><p>拒绝服务还是有点说头的，不过这篇文章已经说的非常清楚了，我在网上看了很多资料，感觉目前以太坊上拒绝服务也就是以下三种：</p><p>(转自: <a href="https://ethfans.org/posts/comprehensive-list-of-common-attacks-and-defense-part-6#1.%20%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%EF%BC%88DOS%EF%BC%89" rel="external nofollow noreferrer">https://ethfans.org/posts/comprehensive-list-of-common-attacks-and-defense-part-6#1. 拒绝服务（DOS）</a>)</p><p><strong>1.通过外部操纵映射或数组（Array）循环</strong> ——在我的经历中，我看过此种模式的各种形式。通常情况下，它出现在 <code>owner</code> 希望在其投资者之间分配代币的情况下，以及，在合约中可以看到类似于 <code>distribute()</code> 函数的情况下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">contract <span class="title class_">DistributeTokens</span> &#123;</span><br><span class="line">    address public owner; <span class="comment">// gets set somewhere</span></span><br><span class="line">    address[] investors; <span class="comment">// array of investors</span></span><br><span class="line">    uint[] investorTokens; <span class="comment">// the amount of tokens each investor gets</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... extra functionality, including transfertoken()</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">invest</span>(<span class="params"></span>) public payable &#123;</span><br><span class="line">        investors.<span class="title function_">push</span>(msg.<span class="property">sender</span>);</span><br><span class="line">        investorTokens.<span class="title function_">push</span>(msg.<span class="property">value</span> * <span class="number">5</span>); <span class="comment">// 5 times the wei sent</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">distribute</span>(<span class="params"></span>) public &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner); <span class="comment">// only owner</span></span><br><span class="line">        <span class="keyword">for</span>(uint i = <span class="number">0</span>; i &lt; investors.<span class="property">length</span>; i++) &#123; </span><br><span class="line">            <span class="comment">// here transferToken(to,amount) transfers &quot;amount&quot; of tokens to the address &quot;to&quot;</span></span><br><span class="line">            <span class="title function_">transferToken</span>(investors[i],investorTokens[i]); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请注意，此合约中的循环遍历的数组可以被人为扩充。攻击者可以创建许多用户帐户，让 <code>investor</code> 数据变得更大。原则上来说，可以让执行 for 循环所需的 Gas 超过区块 Gas 上限，这会使 <code>distribute()</code> 函数变得无法操作。</p><p><strong>2.所有者操作</strong>——另一种常见模式是所有者在合约中具有特定权限，并且必须执行一些任务才能使合约进入下一个状态。例如，ICO 合约要求所有者 <code>finalize()</code> 签订合约，然后才可以转让代币，即</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bool public isFinalized = <span class="literal">false</span>;</span><br><span class="line">address public owner; <span class="comment">// gets set somewhere</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">finalize</span>(<span class="params"></span>) public &#123;</span><br><span class="line">    <span class="built_in">require</span>(msg.<span class="property">sender</span> == owner);</span><br><span class="line">    isFinalized == <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... extra ICO functionality</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// overloaded transfer function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transfer</span>(<span class="params">address _to, uint _value</span>) returns (bool) &#123;</span><br><span class="line">    <span class="built_in">require</span>(isFinalized);</span><br><span class="line">    <span class="variable language_">super</span>.<span class="title function_">transfer</span>(_to,_value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这种情况下，如果权限用户丢失其私钥或变为非活动状态，则整个代币合约就变得无法操作。在这种情况下，如果 <code>owner</code> 无法调用 <code>finalize()</code> 则代币不可转让；即代币系统的全部运作都取决于一个地址。</p><p><strong>3.基于外部调用的进展状态</strong>——有时候，合约被编写成为了进入新的状态需要将 Ether 发送到某个地址，或者等待来自外部来源的某些输入。这些模式也可能导致 DOS 攻击：当外部调用失败时，或由于外部原因而被阻止时。在发送 Ether 的例子中，用户可以创建一个不接受 Ether 的合约。如果合约需要将 Ether 发送到这个地址才能进入新的状态，那么合约将永远不会达到新的状态，因为 Ether 永远不会被发送到合约。</p><h3 id="预防技术">预防技术</h3><p>在第一个例子中，合约不应该遍历可以被外部用户人为操纵的数据结构。建议使用 withdrawal 模式，每个投资者都会调用取出函数独立取出代币。</p><p>在第二个例子中，改变合约的状态需要权限用户参与。在这样的例子中（只要有可能），如果 <code>owner</code> 已经瘫痪，可以使用自动防故障模式。一种解决方案是将 <code>owner</code> 设为一个多签名合约。另一种解决方案是使用一个时间锁，其中 [13]行 上的需求可以包括在基于时间的机制中，例如 <code>require(msg.sender == owner || now &gt; unlockTime)</code> ，那么在由 <code>unlockTime</code> 指定的一段时间后，任何用户都可以调用函数，完成合约。这种缓解技术也可以在第三个例子中使用。如果需要进行外部调用才能进入新状态，请考虑其可能的失败情况；并添加基于时间的状态进度，防止所需外部调用迟迟不到来。</p><p><em>注意：当然，这些建议都有中心化的替代方案，比如，可以添加 <code>maintenanceUser</code> ，它可以在有需要时出来解决基于 DOS 攻击向量的问题。通常，这类合约包含对这类权力实体的信任问题；不过这不是本节要探讨的内容</em>。</p><h3 id="实际例子-2">实际例子</h3><h4 id="GovernMental">GovernMental</h4><p><a href="http://governmental.github.io/GovernMental/" rel="external nofollow noreferrer">GovernMental</a>是一个很久以前的庞氏骗局，积累了相当多的 Ether。实际上，它曾经积累起 1100 个以太。不幸的是，它很容易受到本节提到的 DOS 漏洞的影响。<a href="https://www.reddit.com/r/ethereum/comments/4ghzhv/governmentals_1100_eth_jackpot_payout_is_stuck/" rel="external nofollow noreferrer">这篇 Reddit 帖子</a>描述了合约需要删除一个大的映射来取出以太。删除映射的 Gas 消耗量超过了当时的区块 Gas 上限，因此不可能撤回那 1100 个 Ether。合约地址为 <a href="https://etherscan.io/address/0xf45717552f12ef7cb65e95476f217ea008167ae3" rel="external nofollow noreferrer"><code>0xF45717552f12Ef7cb65e95476F217Ea008167Ae3</code></a>，您可以从交易<a href="https://etherscan.io/tx/0x0d80d67202bd9cb6773df8dd2020e7190a1b0793e8ec4fc105257e8128f0506b" rel="external nofollow noreferrer"><code>0x0d80d67202bd9cb6773df8dd2020e7190a1b0793e8ec4fc105257e8128f0506b</code></a>中看到，最后有人通过使用 250 万 Gas的交易取出了 1100 Ether 。</p><h2 id="伪随机性">伪随机性</h2><p>我觉得伪随机性很好理解，本来区块链就不存在随机熵</p><p>这篇文章我觉得写的非常好，基本上涵盖了当前伪随机数产生的所有问题：<a href="https://blog.positive.com/predicting-random-numbers-in-ethereum-smart-contracts-e5358c6b8620" rel="external nofollow noreferrer"><strong>Predicting Random Numbers in Ethereum Smart Contracts</strong></a></p><p>这篇文章的研究思路如下：</p><ol><li>从etherscan.io和GitHub收集了3,649个智能合约。</li><li>然后将这些合同导入到Elasticsearch开源搜索引擎中。</li><li>使用Kibana Web UI进行丰富的搜索和过滤，发现了72种独特的PRNG实现。</li><li>根据对每份合同的人工评估，确定了43份易受伤害的合同。</li></ol><p>然后分为以下四类脆弱的随机数发生器（PRNG）：</p><ul><li>使用块变量作为熵源的PRNG</li><li>基于过去某个区块的哈希的PRNG</li><li>基于过去区块的区块哈希结合被视为私有的种子的PRNG</li><li>PRNG易于抢先</li></ul><p><strong>摘要部分该文章核心如下</strong></p><h3 id="使用块变量作为熵源的PRNG">使用块变量作为熵源的PRNG</h3><p>这个主要是block.timestamp、block.coinbase、block.difficulty、block.gaslimit、block.number等等块变量引入的，这些变量可以被矿工操纵，所以就很不安全啊；而且这些都公开可查，同一个块内大家都能获取到这些信息，很危险的</p><h3 id="基于过去某个区块的哈希的PRNG">基于过去某个区块的哈希的PRNG</h3><p>block.blockhash()可以用来获取区块hash值，但是它有取值范围，只能适用于已经出块的且取值范围是最新的256个块。也就是说，如果超出范围，取值均为0。因此，block.blockhash(block.number) == 0, 因为block.number此时没有出块</p><h4 id="预防技术-2">预防技术</h4><blockquote><p>A better approach is to use the blockhash of some future block. The implementation scenario is as follows:</p><p>毅哥更好的方法是使用一些未来的区块，实现方案如下：</p><ul><li><p>The player makes a bet and the house stores the block.number of the transaction.</p><p>玩家下注，房屋将存储交易的block.number。</p></li><li><p>In a second call to the contract, the player requests that the house announces the winning number.</p><p>在第二次致电合约时，玩家要求房主宣布中奖号码。</p></li><li><p>The house retrieves the saved block.number from storage and gets its blockhash, which is then used to generate a pseudo-random number.</p><p>房子从存储中检索保存的block.number并获取其blockhash，然后将其用于生成伪随机数。</p></li></ul><p>This approach works only if an important requirement is met. The Solidity documentation warns about the limit of saved blockhashes that the EVM is able to store: The block hashes are not available for all blocks for scalability reasons. You can only access the hashes of the most recent 256 blocks, all other values will be zero.</p><p>仅当满足重要要求时，此方法才有效。Solidity文档警告了EVM可以存储的已保存块哈希的限制：block hashes出于可扩展的考虑，并不对所有区块有效，你仅能获取最新的256个区块的hash值，其他区块hash值返回为0。</p></blockquote><h3 id="基于过去区块的区块哈希结合被视为私有的种子的PRNG">基于过去区块的区块哈希结合被视为私有的种子的PRNG</h3><p>这个玩法不行，因为区块链没有真正意义上的私有变量，实际都可查。。。</p><h3 id="PRNG易于抢先">PRNG易于抢先</h3><p>这个应该也可以算作前置交易漏洞，以太坊的打包政策是，给的gas price高的优先，这就很有操作空间了</p><h4 id="实际例子-3">实际例子</h4><blockquote><p>Consider the following example. A lottery uses an external oracle to get pseudo-random numbers, which are used to determine the winner from among the players who submitted their bets in each round. These numbers are sent unencrypted. An attacker may observe the pool of pending transactions and wait for the number from the oracle. As soon as the oracle’s transaction appears in the transaction pool, an attacker sends a bet with a higher gas price. The attacker’s transaction was made last in the round, but thanks to the higher gas price, is actually executed before the oracle’s transaction, making the attacker victorious. Such a task was featured in the <a href="https://blog.positive.com/zeronights-ico-hacking-contest-writeup-63afb996f1e3" rel="external nofollow noreferrer">ZeroNights ICO Hacking Contest</a>.</p></blockquote><p>考虑以下示例。彩票使用外部预言机来获取伪随机数，该伪随机数用于在每个回合中提交赌注的玩家中确定赢家。这些数字未加密发送。攻击者可能会观察等待交易事务池，并等待来自oracle的数字。一旦oracle的交易出现在交易池中，攻击者便以更高的汽油价格发送赌注。由于汽油价格上涨，攻击者的交易虽然提交的晚，但是确可以在oracle的交易之前执行的，这使攻击者取得了胜利。在<a href="https://blog.positive.com/zeronights-ico-hacking-contest-writeup-63afb996f1e3" rel="external nofollow noreferrer">ZeroNights ICO黑客大赛</a>中就有这样一个赌注。</p><blockquote><p>Another example of a contract prone to front-running is the game called “<a href="https://etherscan.io/address/0x5d9b8fa00c16bcafae47deed872e919c8f6535bf" rel="external nofollow noreferrer">Last is me!</a>”. Every time a player buys a ticket, that player claims the last seat and the timer starts counting down. If nobody buys the ticket within a certain number of blocks, the last player to “take a seat” wins the jackpot. When the round is about to finish, an attacker may observe the transaction pool for other contestants’ transactions and claim the jackpot by means of a higher gas price.</p></blockquote><p>容易发生抢占先机的另一个例子是名为“<a href="https://etherscan.io/address/0x5d9b8fa00c16bcafae47deed872e919c8f6535bf" rel="external nofollow noreferrer">Last is me！Last</a> ”的游戏。玩家每次购买彩票时，该玩家将获得最后一个席位，计时器开始倒计时。如果没有人在一定数量的区块内购买彩票，则最后一个“坐下来”的玩家将赢得大奖。当该回合即将结束时，攻击者可能会观察其他参赛者的交易的交易池，并通过更高的汽油价格索取大奖。</p><h3 id="更好的随机数生成办法">更好的随机数生成办法</h3><p>文章共提到了三种：Oracle or BTCReply\Signidice\Commit–reveal</p><h4 id="Oracle">Oracle</h4><p>就是外部预言机，老铁用图解释的很清楚</p><p><img src="https://i.loli.net/2020/04/20/vKRM7dZBpP2lDuO.png" alt="外部预言机流程"></p><p>其中红色的就是链上的内容，Oraclize daemon和random.org则是链下内容，而且不可控，所以说除非你完全信任两者，不然这也是有风险的。</p><h4 id="BTCReply">BTCReply</h4><p>其实BTCReply就是把以太坊的矿工风险转移到了比特币矿工风险。<a href="http://btcrelay.org/" rel="external nofollow noreferrer">BTCRelay</a>是以太坊和比特币区块链之间的桥梁。使用BTCRelay，以太坊区块链中的智能合约可以请求将来的比特币区块哈希并将其用作熵的来源。将BTCRelay用作PRNG的一个项目是<a href="https://etherscan.io/address/0x302fE87B56330BE266599FAB2A54747299B5aC5B" rel="external nofollow noreferrer">以太坊彩票</a>。</p><p>感觉只是提高了作弊代价阈值吧</p><h4 id="Signidice">Signidice</h4><p>感觉<a href="https://github.com/gluk256/misc/blob/master/rng4ethereum/signidice.md" rel="external nofollow noreferrer">Signidice</a>就是利用算法签名来锁定下注者，也就是一旦出现下注者，就利用赌注所有者的私钥加签名锁定这个下注，然后合约用公钥解签来验证。摘录一下完整流程</p><blockquote><p>该算法适用于那些基于以太坊的游戏，其中玩家的每一轮结果仅取决于RNG和（可选）玩家选择的数字，而不取决于其他玩家的动作。例如，它可能适用于轮盘赌，角子机等，但不适用于那些结果取决于其他玩家或仅取决于其人数的游戏（例如彩票业）。例如，轮盘游戏可以建模为多个回合，其中单个玩家与赌场对战。在这种情况下，可以使用以下算法生成伪随机数。</p><p>​	1. 赌场为确定性签名算法（例如RSA）生成一对新的私钥/公钥（PrivKey和PubKey）。</p><p>​	2. 赌场创建一个智能合约，其中包含公钥（PubKey），最大参与者数和以太坊赏金。（可选：赌场更改现有智能合约的PubKey）。</p><p>​	3. 玩家选择要下注的数字（B）和某种格式（例如20字节）的随机数（R）。如果游戏规则允许，则玩家甚至可以指定数字B的范围（奇数与偶数等）。</p><p>​	4. 玩家发送包含以太币投注以及数据B和R的交易（TX）。</p><p>​	5. 合同检查数字B和R的有效性和格式。无效的TX被拒绝。</p><p>​	6. 此外，合同还会检查该球员在之前的回合中是否已经使用过数字R，在这种情况下，TX被拒绝。（如果合同被重复用于多轮游戏，则此步骤是必需的）。</p><p>​	7. 合同将随机数R与玩家的以太帐户的公共地址（A）串联在一起，从该地址发送TX：V = A +R。结果值V存储在合同中。V的大小始终相同：size（V）= size（A）+ size（R）。在这一点上，回合的结果（胜利或失败）成为确定性的。</p><p>​	8. 娱乐场必须使用其PrivKey对结果值V进行签名，从而产生数字签名S = sign（PrivKey，V），并发送包含S的相应TX。</p><p>​	9. 合同从数字签名S中恢复实际的公钥（K），并验证它是否等于先前发布的PubKey（K == PubKey）。如果APK与PubKey不匹配，或者娱乐场未能在预定义的时间范围内执行步骤8，则等同于作弊。在这种情况下，合同会将奖金和原始赌注一起发送给玩家，然后通过自杀关闭合同。（在多人游戏的情况下，所有玩家共享赏金）。</p><p>​	10. 合同使用S作为预定义PRNG算法（例如，基于SHA-3）的种子，该算法会生成幸运数字（L），例如介于0到36之间。</p><p>​	11. 如果B对应于L，则玩家获胜，否则赌场获胜。合同将赌注发送给获胜者。</p><p>​	12. 现在，赌场可能会关闭合同并收回赏金，或启动新一轮游戏。或者，可以将合同编程为自动进行下一轮，除非赌场将其关闭。</p><p>赌场选择了PrivKey之后，其操作将变为确定性的。玩家无法预测数字签名的结果，因此，他对随机数R的选择只能以与在现实生活中掷骰子相同的方式影响结果（因此该算法的名称）。因此，没有一个参与者可以任何有意义的方式操纵结果。</p></blockquote><p>需要注意的是，ECDSA算法不适合该算法，因为</p><blockquote><p>A [proof-of-concept](<a href="https://github.com/pertsev/web3_utilz/tree/master/ECDSA" rel="external nofollow noreferrer">https://github.com/pertsev/web3_utilz/tree/master/ECDSA</a> signature generating (cheating)) of such cheating has been created by Alexey Pertsev.</p><p>Fortunately, with release of the Metropolis hardfork, a <a href="https://github.com/ethereum/EIPs/pull/198" rel="external nofollow noreferrer">modular exponentiation operator</a> has been introduced. This allows implementing RSA signature verification, which unlike ECDSA does not allow manipulating input parameters to find a suitable signature.</p></blockquote><h4 id="commit-reveal">commit-reveal</h4><p>所谓的提交-披露方法就是：</p><ul><li>“提交”阶段，当事双方将其受密码保护的机密提交给智能合约。</li><li>在“公开”阶段，当当事方宣布明文种子时，智能合约会验证它们是否正确，然后使用种子生成一个随机数。</li></ul><p>举个例子，所有者提供一个随机数seed1，玩家提供一个随机数seed2，但是在『提交』阶段，仅透露sha3(seed1)和sha3(seed2)的值，到公开阶段，双方再披露seed1和seed2的值，然后验证两者，最后生成一个随机数sha3(seed1, seed3, blockhash)，其中blockhash是未来区块hash值。</p><p>这个方法有个弊端就是，所有者也可以是玩家哦~所以，玩家无法信任所有者</p><p>文章有提到说<a href="https://github.com/randao/randao" rel="external nofollow noreferrer">Randao</a>。该PRNG从多个方收集哈希种子，并向每个参与方奖励。没有人知道其他人的种子，因此结果确实是随机的。但是，单方拒绝透露种子将导致拒绝服务。</p><h3 id="总结">总结</h3><p>所以这么看来，世上难得两全法啊~每个方法都有优势和弊端</p><p>区块链的熵源有限。设计PRNG时，开发人员应确保首先了解各方的动机，然后再选择适当的方法。</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://fatheadrat.tk">CapybaraJ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://fatheadrat.tk/posts/a92d10ea/">https://fatheadrat.tk/posts/a92d10ea/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://fatheadrat.tk" target="_blank">CapybaraJ</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SmartContract/">SmartContract</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2024/05/18/VPBtei4gC5Mlf8Z.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s2.loli.net/2024/03/23/qFhbeNHdsyGDclw.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2024/03/23/qFhbeNHdsyGDclw.jpg" alt="功德箱"></a><div class="post-qr-code-desc">功德箱</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/de2a207c/" title="智能合约漏洞介绍3"><img class="cover" src="https://s2.loli.net/2024/05/18/ot5MKVOcAyT9aDG.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">智能合约漏洞介绍3</div></div></a></div><div class="next-post pull-right"><a href="/posts/30244150/" title="智能合约漏洞介绍1"><img class="cover" src="https://s2.loli.net/2024/05/18/d1KoJFsGXrMp6gf.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">智能合约漏洞介绍1</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/30244150/" title="智能合约漏洞介绍1"><img class="cover" src="https://s2.loli.net/2024/05/18/d1KoJFsGXrMp6gf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-02</div><div class="title">智能合约漏洞介绍1</div></div></a></div><div><a href="/posts/de2a207c/" title="智能合约漏洞介绍3"><img class="cover" src="https://s2.loli.net/2024/05/18/ot5MKVOcAyT9aDG.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-21</div><div class="title">智能合约漏洞介绍3</div></div></a></div></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">CapybaraJ</div><div class="author-info__description">Trying to be a Better Fatheadrat ~</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" href="https://github.com/xxxxxx" rel="external nofollow noreferrer"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">博客翻新中，尽请期待</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AA%E4%B8%A5%E6%A0%BC%E5%88%A4%E6%96%AD%E4%B8%8D%E5%AE%89%E5%85%A8%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">1.</span> <span class="toc-text">未严格判断不安全函数调用返回值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90"><span class="toc-number">1.2.</span> <span class="toc-text">实际例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">拒绝服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86-2"><span class="toc-number">2.1.</span> <span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E9%98%B2%E6%8A%80%E6%9C%AF"><span class="toc-number">2.2.</span> <span class="toc-text">预防技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90-2"><span class="toc-number">2.3.</span> <span class="toc-text">实际例子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GovernMental"><span class="toc-number">2.3.1.</span> <span class="toc-text">GovernMental</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">伪随机性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9D%97%E5%8F%98%E9%87%8F%E4%BD%9C%E4%B8%BA%E7%86%B5%E6%BA%90%E7%9A%84PRNG"><span class="toc-number">3.1.</span> <span class="toc-text">使用块变量作为熵源的PRNG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%BF%87%E5%8E%BB%E6%9F%90%E4%B8%AA%E5%8C%BA%E5%9D%97%E7%9A%84%E5%93%88%E5%B8%8C%E7%9A%84PRNG"><span class="toc-number">3.2.</span> <span class="toc-text">基于过去某个区块的哈希的PRNG</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E9%98%B2%E6%8A%80%E6%9C%AF-2"><span class="toc-number">3.2.1.</span> <span class="toc-text">预防技术</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%BF%87%E5%8E%BB%E5%8C%BA%E5%9D%97%E7%9A%84%E5%8C%BA%E5%9D%97%E5%93%88%E5%B8%8C%E7%BB%93%E5%90%88%E8%A2%AB%E8%A7%86%E4%B8%BA%E7%A7%81%E6%9C%89%E7%9A%84%E7%A7%8D%E5%AD%90%E7%9A%84PRNG"><span class="toc-number">3.3.</span> <span class="toc-text">基于过去区块的区块哈希结合被视为私有的种子的PRNG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PRNG%E6%98%93%E4%BA%8E%E6%8A%A2%E5%85%88"><span class="toc-number">3.4.</span> <span class="toc-text">PRNG易于抢先</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90-3"><span class="toc-number">3.4.1.</span> <span class="toc-text">实际例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A5%BD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E5%8A%9E%E6%B3%95"><span class="toc-number">3.5.</span> <span class="toc-text">更好的随机数生成办法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Oracle"><span class="toc-number">3.5.1.</span> <span class="toc-text">Oracle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BTCReply"><span class="toc-number">3.5.2.</span> <span class="toc-text">BTCReply</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Signidice"><span class="toc-number">3.5.3.</span> <span class="toc-text">Signidice</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#commit-reveal"><span class="toc-number">3.5.4.</span> <span class="toc-text">commit-reveal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/f8797f1a/" title="Mac上的automator太好用了"><img src="https://s2.loli.net/2024/08/18/Zt9q23wJVPaLUx5.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Mac上的automator太好用了"></a><div class="content"><a class="title" href="/posts/f8797f1a/" title="Mac上的automator太好用了">Mac上的automator太好用了</a><time datetime="2024-08-18T12:36:21.000Z" title="发表于 2024-08-18 20:36:21">2024-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f9345448/" title="MAC办公(&amp;摸鱼)必备工具箱"><img src="https://s2.loli.net/2024/08/18/JkyD9naW321FXES.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MAC办公(&amp;摸鱼)必备工具箱"></a><div class="content"><a class="title" href="/posts/f9345448/" title="MAC办公(&amp;摸鱼)必备工具箱">MAC办公(&amp;摸鱼)必备工具箱</a><time datetime="2024-08-18T11:02:44.000Z" title="发表于 2024-08-18 19:02:44">2024-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d08abd7b/" title="hexo更新（时隔2年重启博客）"><img src="https://s2.loli.net/2024/05/18/1mJro5Fl3I9aRtH.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="hexo更新（时隔2年重启博客）"></a><div class="content"><a class="title" href="/posts/d08abd7b/" title="hexo更新（时隔2年重启博客）">hexo更新（时隔2年重启博客）</a><time datetime="2024-03-23T03:32:28.000Z" title="发表于 2024-03-23 11:32:28">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/de2a207c/" title="智能合约漏洞介绍3"><img src="https://s2.loli.net/2024/05/18/ot5MKVOcAyT9aDG.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="智能合约漏洞介绍3"></a><div class="content"><a class="title" href="/posts/de2a207c/" title="智能合约漏洞介绍3">智能合约漏洞介绍3</a><time datetime="2020-04-21T11:34:21.000Z" title="发表于 2020-04-21 19:34:21">2020-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a92d10ea/" title="智能合约漏洞介绍2"><img src="https://s2.loli.net/2024/05/18/VPBtei4gC5Mlf8Z.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="智能合约漏洞介绍2"></a><div class="content"><a class="title" href="/posts/a92d10ea/" title="智能合约漏洞介绍2">智能合约漏洞介绍2</a><time datetime="2020-04-03T08:43:33.000Z" title="发表于 2020-04-03 16:43:33">2020-04-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://s2.loli.net/2024/05/18/VPBtei4gC5Mlf8Z.png)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By CapybaraJ</div><div class="framework-info"><span>框架 </span><a href="https://hexo.io" rel="external nofollow noreferrer">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" rel="external nofollow noreferrer">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to capybara's blog !</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadUtterances = () => {
    let ele = document.createElement('script')
    ele.id = 'utterances_comment'
    ele.src = 'https://utteranc.es/client.js'
    ele.setAttribute('repo', 'CapybaraJ/capybaraj.github.io')
    ele.setAttribute('issue-term', 'og:title')
    const nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
    ele.setAttribute('theme', nowTheme)
    ele.crossOrigin = 'anonymous'
    ele.async = true
    document.getElementById('utterances-wrap').appendChild(ele)
  }

  const utterancesTheme = theme => {
    const iframe = document.querySelector('.utterances-frame')
    if (iframe) {
      const theme = theme === 'dark' ? 'photon-dark' : 'github-light'
      const message = {
        type: 'set-theme',
        theme: theme
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  }

  btf.addGlobalFn('themeChange', utterancesTheme, 'utterances')

  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.22.1/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.65.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div></body></html>